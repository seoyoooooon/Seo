import streamlit as st
import pandas as pd

st.title("ğŸš 2025ë…„ 6ì›” êµí†µì¹´ë“œ í†µê³„ ë¶„ì„")

# íŒŒì¼ ì—…ë¡œë“œ
uploaded_file = st.file_uploader("ğŸ“‚ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (EUC-KR ì¸ì½”ë”©)", type=["csv"])

if uploaded_file is not None:
    try:
        # EUC-KR ì¸ì½”ë”©ìœ¼ë¡œ CSV ì½ê¸°
        df = pd.read_csv(uploaded_file, encoding="euc-kr")
    except Exception as e:
        st.error(f"âŒ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
    else:
        st.subheader("ğŸ“‹ ì›ë³¸ ë°ì´í„° (ìƒìœ„ 10í–‰)")
        st.dataframe(df.head(10))

        # 'ë…¸ì„ ë²ˆí˜¸'ë¡œ ì‹œì‘í•˜ëŠ” ì—´ ì°¾ê¸°
        route_columns = [col for col in df.columns if col.startswith("ë…¸ì„ ë²ˆí˜¸")]

        if not route_columns:
            st.warning("âš ï¸ 'ë…¸ì„ ë²ˆí˜¸'ë¡œ ì‹œì‘í•˜ëŠ” ì—´ì´ ì—†ìŠµë‹ˆë‹¤.")
        else:
            # ì—´ ì´ë¦„ ì •ì œ (ì—°ë ¹ë§Œ ë‚¨ê¸°ê¸°)
            new_column_names = ['í–‰ì •êµ¬ì—­', 'ìŠ¹ì°¨ë“±ê°ìˆ˜'] + [
                col.replace("ë…¸ì„ ë²ˆí˜¸", "").replace("ì„¸", "").strip() + "ì„¸" for col in route_columns
            ]
            
            # í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ
            subset = df[["í–‰ì •êµ¬ì—­", "ìŠ¹ì°¨ë“±ê°ìˆ˜"] + route_columns].copy()
            subset.columns = new_column_names

            # ìŠ¹ì°¨ë“±ê°ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 5ê°œ í–‰ì •êµ¬ì—­ ì¶”ì¶œ
            subset["ìŠ¹ì°¨ë“±ê°ìˆ˜"] = pd.to_numeric(subset["ìŠ¹ì°¨ë“±ê°ìˆ˜"], errors="coerce")
            top5 = subset.sort_values("ìŠ¹ì°¨ë“±ê°ìˆ˜", ascending=False).head(5)

            st.subheader("â­ ìƒìœ„ 5ê°œ í–‰ì •êµ¬ì—­ (ìŠ¹ì°¨ë“±ê°ìˆ˜ ê¸°ì¤€)")
            st.dataframe(top5)

            # ì‹œê°í™”
            st.subheader("ğŸ“ˆ ì—°ë ¹ë³„ ìŠ¹ì°¨ ìŠ¹ê°ìˆ˜ (ë…¸ì„ ë²ˆí˜¸ ê¸°ì¤€ ì„  ê·¸ë˜í”„)")
            age_cols = top5.columns[2:]  # ì—°ë ¹ë³„ ì—´
            for idx, row in top5.iterrows():
                st.markdown(f"#### ğŸ“ {row['í–‰ì •êµ¬ì—­']}")
                age_data = pd.to_numeric(row[age_cols], errors="coerce")
                age_df = pd.DataFrame(age_data.values, index=age_cols, columns=["ìŠ¹ì°¨ìŠ¹ê°ìˆ˜"])
                st.line_chart(age_df)

        st.success("âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
else:
    st.info("ë¨¼ì € CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.")
